<link rel="import"
      href="../../bower_components/polymer/polymer.html">
<link rel="import"
      href="../viewer-nav/viewer-nav.html">
<link rel="import"
      href="../viewer-domain/viewer-domain.html">

<dom-module id="viewer-app">
  <template>
    <div class="wrapper">
      <viewer-nav
        domains="{{domains}}"
        on-domain-changed="setDomain"></viewer-nav>
      <viewer-domain
        domain="{{selectedDomain}}"></viewer-domain>
    </div>
  </template>
  <script>
    (function () {
      function getColor(index, all) {
        var hue = 360 / all * index;
        return "hsl(" + hue + ", 52%, 91%)";
      }

      Polymer({
        is: 'viewer-app',
        ready: function () {
          this.selectedDomain = null;
        },
        setDomain: function (event, details) {
          this.selectedDomain = details.domain;
        },
        setProtocolSchema: function (protocolSchema) {
          var domains = protocolSchema['domains'];

          this.domains = domains.sort(function (a, b) {
            return (a.domain).localeCompare(b.domain);
          }).map(function (domain, i) {
            return {
              name: domain.domain,
              description: domain.description,
              methods: domain.commands,
              events: domain.events,
              types: domain.types,
              color: getColor(i, domains.length)
            };
          });
        }
      });
    })();
  </script>
  <style>
    .wrapper {
      display: flex;
    }

    viewer-domain {
      flex-grow: 1;
    }
  </style>
</dom-module>
